<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Caixa - Lanchonete</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary-custom">
        <div class="container-fluid">
            <a class="navbar-brand" href="#" id="establishmentNameDisplay">Lanchonete</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="nav nav-tabs ms-auto" id="appTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="pos-tab" data-bs-toggle="tab" data-bs-target="#pos" type="button" role="tab" aria-controls="pos" aria-selected="true"><i class="bi bi-cash-register"></i> Caixa</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="products-tab" data-bs-toggle="tab" data-bs-target="#products" type="button" role="tab" aria-controls="products" aria-selected="false"><i class="bi bi-box-seam"></i> Produtos</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="categories-tab" data-bs-toggle="tab" data-bs-target="#categories" type="button" role="tab" aria-controls="categories" aria-selected="false"><i class="bi bi-tags"></i> Categorias</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="reports-tab" data-bs-toggle="tab" data-bs-target="#reports" type="button" role="tab" aria-controls="reports" aria-selected="false"><i class="bi bi-file-earmark-bar-graph"></i> Relatórios</button>
                    </li>
                     <li class="nav-item" role="presentation">
                        <button class="nav-link" id="cash-management-tab" data-bs-toggle="tab" data-bs-target="#cash-management" type="button" role="tab" aria-controls="cash-management" aria-selected="false"><i class="bi bi-safe"></i> Gerenciar Caixa</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings" type="button" role="tab" aria-controls="settings" aria-selected="false"><i class="bi bi-gear"></i> Configurações</button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-3">
        <div class="tab-content" id="appTabContent">
            <!-- Point of Sale (POS) Tab -->
            <div class="tab-pane fade show active" id="pos" role="tabpanel" aria-labelledby="pos-tab">
                <h4>Ponto de Venda</h4>
                <div class="row">
                    <div class="col-md-5">
                        <h5>Selecionar Produtos</h5>
                        <div class="mb-3">
                            <label for="posCategoryFilter" class="form-label">Filtrar por Categoria:</label>
                            <select id="posCategoryFilter" class="form-select mb-2"></select>
                            <input type="text" id="posProductSearch" class="form-control mb-2" placeholder="Buscar produto...">
                        </div>
                        <div id="posProductList" class="list-group product-selection-list">
                            <!-- Products will be listed here -->
                        </div>
                    </div>
                    <div class="col-md-7">
                        <h5>Pedido Atual: #<span id="currentOrderNumberDisplay">1</span> 
                            <button class="btn btn-sm btn-outline-secondary ms-2" id="editOrderNumberBtn"><i class="bi bi-pencil"></i></button>
                        </h5>
                        <div id="currentOrderItems" class="mb-3">
                            <!-- Current order items will be listed here -->
                            <p class="text-muted">Nenhum item no pedido.</p>
                        </div>
                        <h5 class="text-end">Total: R$ <span id="currentOrderTotal">0.00</span></h5>
                        <hr>
                        <h6>Detalhes do Cliente (Opcional)</h6>
                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label for="customerName" class="form-label">Nome:</label>
                                <input type="text" class="form-control" id="customerName" placeholder="Nome do Cliente">
                            </div>
                            <div class="col-md-6">
                                <label for="customerPhone" class="form-label">Telefone:</label>
                                <input type="tel" class="form-control" id="customerPhone" placeholder="Telefone">
                            </div>
                            <div class="col-12">
                                <label for="customerObservations" class="form-label">Observações:</label>
                                <textarea class="form-control" id="customerObservations" rows="2" placeholder="Ex: Sem cebola, ponto da carne..."></textarea>
                            </div>
                        </div>
                         <h6>Forma de Pagamento</h6>
                        <div class="mb-3">
                            <select id="paymentMethod" class="form-select">
                                <option value="dinheiro">Dinheiro</option>
                                <option value="cartao_credito">Cartão de Crédito</option>
                                <option value="cartao_debito">Cartão de Débito</option>
                                <option value="pix">PIX</option>
                            </select>
                        </div>
                        <div class="d-grid gap-2">
                            <button class="btn btn-success btn-lg" id="finalizeOrderBtn"><i class="bi bi-check-circle"></i> Finalizar Pedido e Imprimir</button>
                            <button class="btn btn-danger" id="cancelOrderBtn"><i class="bi bi-x-circle"></i> Cancelar Pedido</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Products Tab -->
            <div class="tab-pane fade" id="products" role="tabpanel" aria-labelledby="products-tab">
                <h4>Gerenciar Produtos</h4>
                <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#productModal" id="addProductBtn"><i class="bi bi-plus-circle"></i> Adicionar Produto</button>
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Preço</th>
                            <th>Categoria</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="productListTableBody">
                        <!-- Product rows will be inserted here -->
                    </tbody>
                </table>
            </div>

            <!-- Categories Tab -->
            <div class="tab-pane fade" id="categories" role="tabpanel" aria-labelledby="categories-tab">
                <h4>Gerenciar Categorias</h4>
                <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#categoryModal" id="addCategoryBtn"><i class="bi bi-plus-circle"></i> Adicionar Categoria</button>
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Nome da Categoria</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="categoryListTableBody">
                        <!-- Category rows will be inserted here -->
                    </tbody>
                </table>
            </div>

            <!-- Reports Tab -->
            <div class="tab-pane fade" id="reports" role="tabpanel" aria-labelledby="reports-tab">
                <h4>Relatórios de Vendas</h4>
                <div class="row mb-3">
                    <div class="col-md-3">
                        <label for="reportDateFilter" class="form-label">Filtrar por Data:</label>
                        <input type="date" id="reportDateFilter" class="form-control">
                    </div>
                    <div class="col-md-3 d-flex align-items-end">
                         <button class="btn btn-info" id="filterReportBtn"><i class="bi bi-funnel"></i> Filtrar</button>
                         <button class="btn btn-secondary ms-2" id="clearReportFilterBtn"><i class="bi bi-x"></i> Limpar</button>
                    </div>
                    <div class="col-md-6 d-flex align-items-end justify-content-end">
                        <button class="btn btn-success" id="printSalesReportBtn"><i class="bi bi-printer"></i> Imprimir Relatório</button>
                    </div>
                </div>
                <div id="salesReportSummary" class="mb-3">
                    <h5>Resumo do Período</h5>
                    <p>Total de Pedidos: <span id="reportTotalOrders">0</span></p>
                    <p>Receita Total: R$ <span id="reportTotalRevenue">0.00</span></p>
                </div>
                <div id="printableSalesReportArea">
                    <h5 id="reportTitle">Relatório de Vendas</h5>
                    <table class="table table-sm table-bordered">
                        <thead>
                            <tr>
                                <th># Pedido</th>
                                <th>Data</th>
                                <th>Cliente</th>
                                <th>Itens</th>
                                <th>Total</th>
                                <th>Pagamento</th>
                            </tr>
                        </thead>
                        <tbody id="salesReportTableBody">
                            <!-- Sales report data -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Cash Management Tab -->
            <div class="tab-pane fade" id="cash-management" role="tabpanel" aria-labelledby="cash-management-tab">
                <h4>Gerenciamento de Caixa</h4>
                <div id="cashStatusArea" class="mb-3">
                    <p>Status do Caixa: <span id="cashRegisterStatus" class="fw-bold">Fechado</span></p>
                    <p id="cashOpenTime">Aberto em: N/A</p>
                    <p id="cashInitialAmount">Valor Inicial: R$ <span id="cashOpenInitialAmountDisplay">0.00</span></p>
                </div>
                <div class="mb-3">
                     <button class="btn btn-success me-2" id="openCashRegisterBtn" disabled><i class="bi bi-box-arrow-in-down-right"></i> Abrir Caixa</button>
                     <button class="btn btn-danger" id="closeCashRegisterBtn" disabled><i class="bi bi-box-arrow-up-left"></i> Fechar Caixa</button>
                </div>
                <div id="cashSessionReport" class="mt-3 p-3 border rounded" style="display: none;">
                    <h5>Relatório da Sessão Atual/Última</h5>
                    <p>Abertura: <span id="sessionOpenTime">--</span></p>
                    <p>Fechamento: <span id="sessionCloseTime">--</span></p>
                    <p>Valor Inicial: R$ <span id="sessionInitialAmount">0.00</span></p>
                    <p>Vendas (Dinheiro): R$ <span id="sessionSalesCash">0.00</span></p>
                    <p>Vendas (Cartão): R$ <span id="sessionSalesCard">0.00</span></p>
                    <p>Vendas (PIX): R$ <span id="sessionSalesPix">0.00</span></p>
                    <p>Total Vendas: R$ <span id="sessionTotalSales">0.00</span></p>
                    <p>Valor Esperado em Caixa (Inicial + Dinheiro): R$ <span id="sessionExpectedInCash">0.00</span></p>
                    <button class="btn btn-info mt-2" id="printCashSessionReportBtn"><i class="bi bi-printer"></i> Imprimir Relatório do Caixa</button>
                </div>
            </div>


            <!-- Settings Tab -->
            <div class="tab-pane fade" id="settings" role="tabpanel" aria-labelledby="settings-tab">
                <h4>Configurações</h4>
                <div class="mb-3">
                    <label for="establishmentNameInput" class="form-label">Nome do Estabelecimento:</label>
                    <input type="text" class="form-control" id="establishmentNameInput" placeholder="Ex: Lanchonete do Zé">
                </div>
                <div class="mb-3">
                    <label for="nextOrderNumberInput" class="form-label">Próximo Número do Pedido:</label>
                    <input type="number" class="form-control" id="nextOrderNumberInput" min="1">
                </div>
                <button class="btn btn-primary" id="saveSettingsBtn"><i class="bi bi-save"></i> Salvar Configurações</button>
                <hr>
                <h5>Gerenciamento de Dados</h5>
                <p class="text-muted">Use com cuidado. Isso pode apagar todos os seus dados.</p>
                 <button class="btn btn-warning me-2" id="exportDataBtn"><i class="bi bi-download"></i> Exportar Dados</button>
                 <label for="importDataFile" class="btn btn-info"><i class="bi bi-upload"></i> Importar Dados</label>
                 <input type="file" id="importDataFile" accept=".json" style="display: none;">
                <button class="btn btn-danger mt-3" id="resetAllDataBtn"><i class="bi bi-trash3-fill"></i> Resetar Todos os Dados</button>
            </div>
        </div>
    </div>

    <!-- Product Modal -->
    <div class="modal fade" id="productModal" tabindex="-1" aria-labelledby="productModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="productModalLabel">Adicionar Produto</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="productForm">
                        <input type="hidden" id="productId">
                        <div class="mb-3">
                            <label for="productName" class="form-label">Nome do Produto</label>
                            <input type="text" class="form-control" id="productName" required>
                        </div>
                        <div class="mb-3">
                            <label for="productPrice" class="form-label">Preço (R$)</label>
                            <input type="number" class="form-control" id="productPrice" step="0.01" required>
                        </div>
                        <div class="mb-3">
                            <label for="productCategory" class="form-label">Categoria</label>
                            <select class="form-select" id="productCategory" required>
                                <!-- Options will be populated by JS -->
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">Salvar Produto</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Category Modal -->
    <div class="modal fade" id="categoryModal" tabindex="-1" aria-labelledby="categoryModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="categoryModalLabel">Adicionar Categoria</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="categoryForm">
                        <input type="hidden" id="categoryId">
                        <div class="mb-3">
                            <label for="categoryName" class="form-label">Nome da Categoria</label>
                            <input type="text" class="form-control" id="categoryName" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Salvar Categoria</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Confirm Modal -->
    <div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="confirmModalLabel">Confirmação</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body" id="confirmModalBody">
            Tem certeza que deseja realizar esta ação?
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="confirmModalCancelBtn">Cancelar</button>
            <button type="button" class="btn btn-danger" id="confirmModalConfirmBtn">Confirmar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Receipt Modal (for printing) -->
    <div id="receiptPreviewModal" class="modal fade" tabindex="-1" aria-labelledby="receiptPreviewModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="receiptPreviewModalLabel">Visualizar Recibo</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="receiptContentArea">
                    <!-- Receipt content will be injected here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                    <button type="button" class="btn btn-primary" id="printActualReceiptBtn"><i class="bi bi-printer"></i> Imprimir</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Open Cash Register Modal -->
    <div class="modal fade" id="openCashModal" tabindex="-1" aria-labelledby="openCashModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="openCashModalLabel">Abrir Caixa</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="openCashForm">
                        <div class="mb-3">
                            <label for="initialCashAmount" class="form-label">Valor Inicial em Caixa (R$)</label>
                            <input type="number" class="form-control" id="initialCashAmount" step="0.01" value="0.00" required>
                        </div>
                        <button type="submit" class="btn btn-success">Confirmar Abertura</button>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <div id="printableArea" style="display: none;"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="app.js"></script>
</body>
</html>